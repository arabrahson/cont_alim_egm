<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gestión de Menús Semanales</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  h2 { margin-top: 30px; }
  table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
  th, td { border: 1px solid #ccc; padding: 5px; text-align: left; }
  input[type='number'], input[type='text'] { width: 60px; }
  .menu { margin-bottom: 20px; padding: 10px; border: 1px solid #999; }
  .boton { margin-top: 10px; }
</style>
</head>
<body>
<h1>Gestión de Menús Semanales</h1>

<div>
  <label>Matricula del Alumno: </label>
  <input type="text" id="matricula" placeholder="Ej. 12345">
</div>

<div id="menusContainer"></div>
<button onclick="guardarSeleccion()" class="boton">Guardar Selección</button>
<button onclick="generarReporte()" class="boton">Generar Reporte Semanal</button>

<div id="reporteContainer"></div>

<script>
// Aquí ponemos los menús (resumen ejemplo, se puede expandir con todos los que me enviaste)
const menus = [
  {
    semana: 1,
    menu: 1,
    platillos: [
      {nombre: 'Sándwich o Taco de Huevo con Espinaca y Queso', ingredientes: [
        {nombre: 'Pan integral', cantidad: 0.1, unidad:'Paquetes'},
        {nombre: 'Huevo', cantidad: 0.035, unidad:'Kg'},
        {nombre: 'Espinaca', cantidad:0.03, unidad:'Kg'},
        {nombre: 'Cebolla', cantidad:0.0005, unidad:'Kg'},
        {nombre: 'Aceite', cantidad:0.0003, unidad:'L'},
        {nombre: 'Queso panela', cantidad:0.012, unidad:'Kg'},
        {nombre: 'Lechuga', cantidad:0.005, unidad:'Kg'},
        {nombre: 'Jitomate', cantidad:0.005, unidad:'Kg'}
      ]},
      {nombre: 'Ensalada Dulce', ingredientes:[
        {nombre:'Zanahoria', cantidad:0.025, unidad:'Kg'},
        {nombre:'Piña', cantidad:0.08, unidad:'Kg'},
        {nombre:'Cacahuate', cantidad:0.005, unidad:'Kg'},
        {nombre:'Yogurth natural', cantidad:0.006, unidad:'L'}
      ]},
      {nombre: 'Bebida', ingredientes:[
        {nombre:'Agua natural', cantidad:0.0125, unidad:'Garrafones'},
        {nombre:'Tortilla de maíz', cantidad:0.06, unidad:'Kg'}
      ]}
    ]
  },
  // Se pueden agregar todos los menús que enviaste aquí siguiendo la misma estructura
];

function renderMenus() {
  const container = document.getElementById('menusContainer');
  container.innerHTML = '';
  menus.forEach(m => {
    const div = document.createElement('div');
    div.classList.add('menu');
    let html = `<h2>Semana ${m.semana} - Menú ${m.menu}</h2>`;
    m.platillos.forEach(p => {
      html += `<h3>${p.nombre}</h3>`;
      html += `<table><tr><th>Ingrediente</th><th>Cantidad</th><th>Unidad</th><th>Precio por unidad</th></tr>`;
      p.ingredientes.forEach(i => {
        html += `<tr><td>${i.nombre}</td><td>${i.cantidad}</td><td>${i.unidad}</td><td><input type='number' value='0' data-ing='${i.nombre}' data-menu='${m.menu}' data-semana='${m.semana}'></td></tr>`;
      });
      html += `</table>`;
    });
    html += `<label>Seleccionar menú: <input type='checkbox' data-menu='${m.menu}' data-semana='${m.semana}'></label>`;
    div.innerHTML = html;
    container.appendChild(div);
  });
}

function guardarSeleccion() {
  const matricula = document.getElementById('matricula').value.trim();
  if (!matricula) { alert('Ingresa la matrícula'); return; }

  let seleccion = JSON.parse(localStorage.getItem('seleccion')) || {};
  seleccion[matricula] = [];

  menus.forEach(m => {
    const checkbox = document.querySelector(`input[type='checkbox'][data-menu='${m.menu}'][data-semana='${m.semana}']`);
    if (checkbox.checked) {
      let menuData = {semana:m.semana, menu:m.menu, ingredientes:[]};
      m.platillos.forEach(p => {
        p.ingredientes.forEach(i => {
          const precioInput = document.querySelector(`input[type='number'][data-ing='${i.nombre}'][data-menu='${m.menu}'][data-semana='${m.semana}']`);
          menuData.ingredientes.push({nombre:i.nombre, cantidad:i.cantidad, unidad:i.unidad, precio: parseFloat(precioInput.value)});
        });
      });
      seleccion[matricula].push(menuData);
    }
  });

  localStorage.setItem('seleccion', JSON.stringify(seleccion));
  alert('Selección guardada correctamente');
}

function generarReporte() {
  const matricula = document.getElementById('matricula').value.trim();
  if (!matricula) { alert('Ingresa la matrícula'); return; }
  let seleccion = JSON.parse(localStorage.getItem('seleccion')) || {};
  const reportContainer = document.getElementById('reporteContainer');
  reportContainer.innerHTML = '';

  if (!seleccion[matricula] || seleccion[matricula].length === 0) { reportContainer.innerHTML = '<p>No hay menús seleccionados</p>'; return; }

  // Generar totales por semana
  let semanas = {};
  seleccion[matricula].forEach(m => {
    if (!semanas[m.semana]) semanas[m.semana] = {};
    m.ingredientes.forEach(i => {
      if (!semanas[m.semana][i.nombre]) semanas[m.semana][i.nombre] = {cantidad:0, unidad:i.unidad, precio:0};
      semanas[m.semana][i.nombre].cantidad += i.cantidad;
      semanas[m.semana][i.nombre].precio += i.precio * i.cantidad;
    });
  });

  for (const s in semanas) {
    let html = `<h2>Semana ${s}</h2><table><tr><th>Ingrediente</th><th>Total Cantidad</th><th>Unidad</th><th>Total Precio</th></tr>`;
    for (const i in semanas[s]) {
      html += `<tr><td>${i}</td><td>${semanas[s][i].cantidad.toFixed(3)}</td><td>${semanas[s][i].unidad}</td><td>$${semanas[s][i].precio.toFixed(2)}</td></tr>`;
    }
    html += '</table>';
    reportContainer.innerHTML += html;
  }
}

renderMenus();
</script>
</body>
</html>
